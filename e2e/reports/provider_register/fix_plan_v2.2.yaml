app: provider_register
base_url: https://provider-register-jamarrlmayes.replit.app
version: v2.2
owner: Frontend Engineering Team
target_score: 4
generated_at: "2025-10-29T18:00:00Z"

known_blockers:
  - id: FP-PROVIDER-REGISTER
    description: /register route missing (404) prevents B2B provider onboarding and revenue
    gate_impact: T+48h Revenue Gate
    severity: P0
    current_score: 2/5
    target_score: 4/5

tasks:
  - id: FP-PROVIDER-REGISTER
    title: Implement /register page with provider onboarding form (3% fee disclosure)
    summary: Create registration page for scholarship providers with explicit 3% platform fee transparency
    priority: P0
    estimate_hours: 2-4
    owner: Frontend Engineering
    
    root_cause:
      React Router does not include /register route. Component does not exist.
    
    changes:
      - file: Router configuration file (path unknown for unique app)
        action: add
        notes: Register /register route
        
        code_diff: |
          import { Register } from './pages/register';
          
          // In Routes component
          <Route path="/register" element={<Register />} />
      
      - file: pages/register.tsx (create in appropriate location)
        action: create
        notes: |
          Create provider registration form with:
          - Organization details
          - Contact information
          - Explicit 3% platform fee disclosure
          - Terms acceptance
        
        code_diff: |
          import { Button } from '@/components/ui/button';
          import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
          import { Input } from '@/components/ui/input';
          import { Label } from '@/components/ui/label';
          import { Checkbox } from '@/components/ui/checkbox';
          import { useForm } from 'react-hook-form';
          import { zodResolver } from '@hookform/resolvers/zod';
          import { z } from 'zod';
          import { Helmet } from 'react-helmet-async';
          import { AlertCircle, CheckCircle } from 'lucide-react';
          import { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
          
          const registerSchema = z.object({
            organizationName: z.string().min(2, 'Organization name must be at least 2 characters'),
            contactName: z.string().min(2, 'Contact name must be at least 2 characters'),
            email: z.string().email('Invalid email address'),
            phone: z.string().optional(),
            acceptTerms: z.boolean().refine((val) => val === true, {
              message: 'You must accept the terms and conditions'
            }),
            acceptFee: z.boolean().refine((val) => val === true, {
              message: 'You must acknowledge the 3% platform fee'
            })
          });
          
          type RegisterForm = z.infer<typeof registerSchema>;
          
          export function Register() {
            const form = useForm<RegisterForm>({
              resolver: zodResolver(registerSchema),
              defaultValues: {
                organizationName: '',
                contactName: '',
                email: '',
                phone: '',
                acceptTerms: false,
                acceptFee: false
              }
            });
            
            const onSubmit = async (data: RegisterForm) => {
              // TODO: Implement API call to POST /api/providers/register
              console.log('Provider registration:', data);
            };
            
            return (
              <>
                <Helmet>
                  <title>Register Your Organization - ScholarSync Provider Portal</title>
                  <meta name="description" content="Register your organization to provide scholarships through ScholarMatch. Transparent 3% platform fee." />
                </Helmet>
                
                <div className="container mx-auto px-4 py-16 max-w-2xl" data-testid="page-register">
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-3xl" data-testid="heading-register">
                        Provider Registration
                      </CardTitle>
                      <CardDescription>
                        Join ScholarSync to connect your scholarships with qualified students
                      </CardDescription>
                    </CardHeader>
                    
                    <CardContent>
                      <div className="bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6">
                        <div className="flex items-start gap-3">
                          <AlertCircle className="h-5 w-5 text-blue-600 dark:text-blue-400 shrink-0 mt-0.5" />
                          <div>
                            <h3 className="font-semibold text-blue-900 dark:text-blue-100 mb-1">
                              Transparent Pricing
                            </h3>
                            <p className="text-sm text-blue-800 dark:text-blue-200" data-testid="text-fee-disclosure">
                              ScholarSync charges a <strong>3% platform fee</strong> on scholarship awards processed through our system.
                              This fee covers platform maintenance, student support, and technology costs.
                            </p>
                          </div>
                        </div>
                      </div>
                      
                      <Form {...form}>
                        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
                          <FormField
                            control={form.control}
                            name="organizationName"
                            render={({ field }) => (
                              <FormItem>
                                <FormLabel>Organization Name *</FormLabel>
                                <FormControl>
                                  <Input 
                                    {...field} 
                                    placeholder="Acme Foundation"
                                    data-testid="input-organization-name"
                                  />
                                </FormControl>
                                <FormMessage />
                              </FormItem>
                            )}
                          />
                          
                          <FormField
                            control={form.control}
                            name="contactName"
                            render={({ field }) => (
                              <FormItem>
                                <FormLabel>Contact Name *</FormLabel>
                                <FormControl>
                                  <Input 
                                    {...field} 
                                    placeholder="Jane Smith"
                                    data-testid="input-contact-name"
                                  />
                                </FormControl>
                                <FormMessage />
                              </FormItem>
                            )}
                          />
                          
                          <FormField
                            control={form.control}
                            name="email"
                            render={({ field }) => (
                              <FormItem>
                                <FormLabel>Email Address *</FormLabel>
                                <FormControl>
                                  <Input 
                                    {...field} 
                                    type="email"
                                    placeholder="contact@acmefoundation.org"
                                    data-testid="input-email"
                                  />
                                </FormControl>
                                <FormMessage />
                              </FormItem>
                            )}
                          />
                          
                          <FormField
                            control={form.control}
                            name="phone"
                            render={({ field }) => (
                              <FormItem>
                                <FormLabel>Phone Number (Optional)</FormLabel>
                                <FormControl>
                                  <Input 
                                    {...field} 
                                    type="tel"
                                    placeholder="+1 (555) 123-4567"
                                    data-testid="input-phone"
                                  />
                                </FormControl>
                                <FormMessage />
                              </FormItem>
                            )}
                          />
                          
                          <FormField
                            control={form.control}
                            name="acceptFee"
                            render={({ field }) => (
                              <FormItem className="flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4">
                                <FormControl>
                                  <Checkbox
                                    checked={field.value}
                                    onCheckedChange={field.onChange}
                                    data-testid="checkbox-accept-fee"
                                  />
                                </FormControl>
                                <div className="space-y-1 leading-none">
                                  <FormLabel>
                                    I acknowledge the <strong>3% platform fee</strong> on scholarship awards *
                                  </FormLabel>
                                  <FormDescription>
                                    This fee will be automatically deducted from scholarship awards processed through ScholarMatch.
                                  </FormDescription>
                                  <FormMessage />
                                </div>
                              </FormItem>
                            )}
                          />
                          
                          <FormField
                            control={form.control}
                            name="acceptTerms"
                            render={({ field }) => (
                              <FormItem className="flex flex-row items-start space-x-3 space-y-0">
                                <FormControl>
                                  <Checkbox
                                    checked={field.value}
                                    onCheckedChange={field.onChange}
                                    data-testid="checkbox-accept-terms"
                                  />
                                </FormControl>
                                <div className="space-y-1 leading-none">
                                  <FormLabel>
                                    I accept the <a href="/terms" className="text-primary underline">Terms of Service</a> and <a href="/privacy" className="text-primary underline">Privacy Policy</a> *
                                  </FormLabel>
                                  <FormMessage />
                                </div>
                              </FormItem>
                            )}
                          />
                          
                          <Button 
                            type="submit" 
                            className="w-full"
                            data-testid="button-submit-registration"
                          >
                            Register Organization
                          </Button>
                        </form>
                      </Form>
                    </CardContent>
                  </Card>
                  
                  <div className="mt-8 text-center text-sm text-muted-foreground">
                    <p>
                      Questions? Contact us at <a href="mailto:providers@scholarmatch.ai" className="text-primary underline">providers@scholarmatch.ai</a>
                    </p>
                  </div>
                </div>
              </>
            );
          }
    
    verification:
      - step: "curl -I https://provider-register-jamarrlmayes.replit.app/register"
        expect: "HTTP/1.1 200 OK"
      
      - step: "curl -sS https://provider-register-jamarrlmayes.replit.app/register | grep -i 'Provider Registration'"
        expect: "Match found (heading present)"
      
      - step: "curl -sS https://provider-register-jamarrlmayes.replit.app/register | grep -i '3%'"
        expect: "Match found (fee disclosure visible)"
      
      - step: "curl -sS https://provider-register-jamarrlmayes.replit.app/register | grep -i 'platform fee'"
        expect: "Match found (fee terminology present)"
      
      - step: "3-sample P95 test (30s spacing)"
        expect: "P95 TTFB ≤ 190ms (target ≤160ms for 5/5)"
      
      - step: "Visual inspection"
        expect: |
          - Registration form visible
          - All required fields present
          - "3% platform fee" disclosure prominent and clear
          - Fee acknowledgment checkbox required
          - Submit button functional
          - Mobile responsive layout
    
    success_criteria:
      - /register returns 200 OK
      - Page displays provider registration form
      - Form includes organization name, contact name, email fields
      - **"3% platform fee" disclosure is prominent and explicit**
      - Fee acknowledgment checkbox is required (form cannot submit without it)
      - Terms of service checkbox is required
      - Submit button present and functional
      - SEO meta tags complete (<title>, description)
      - P95 TTFB ≤ 190ms (acceptable for 4/5; target ≤160ms for 5/5)
      - Score increases from 2/5 to ≥4/5
    
    rollback_plan: |
      1. Remove /register route from router configuration
      2. Delete register page component file
      3. Restart workflow
      4. Verify /register returns to 404 state
    
    risk: low
    notes: |
      - Static form initially (backend integration separate task)
      - Can implement frontend without backend dependencies
      - Responsive design critical for mobile users
      - Fee disclosure must be VERY CLEAR to avoid legal issues

  - id: FP-PROVIDER-BACKEND
    title: Implement POST /register endpoint for provider persistence
    summary: Create backend handler for provider registration with validation and credential generation
    priority: P1
    estimate_hours: 3-4
    owner: Backend Engineering
    dependencies: [FP-PROVIDER-REGISTER, FP-AUTH-JWKS-RS256]
    
    changes:
      - file: shared/schema.ts
        action: add
        notes: Add providers table schema
        
        code_diff: |
          export const providers = pgTable('providers', {
            id: varchar('id').primaryKey().default(sql`gen_random_uuid()`),
            organizationName: varchar('organization_name').notNull(),
            contactName: varchar('contact_name').notNull(),
            email: varchar('email').notNull().unique(),
            phone: varchar('phone'),
            apiKey: varchar('api_key').unique(),
            status: varchar('status').notNull().default('pending'), // pending, approved, suspended
            feeRate: real('fee_rate').notNull().default(0.03), // 3% = 0.03
            acceptedTermsAt: timestamp('accepted_terms_at').notNull(),
            createdAt: timestamp('created_at').notNull().defaultNow(),
            updatedAt: timestamp('updated_at').notNull().defaultNow()
          });
      
      - file: server/routes.ts
        action: add
        notes: POST /api/providers/register endpoint
        
        code_diff: |
          app.post('/api/providers/register', async (req, res) => {
            const schema = z.object({
              organizationName: z.string().min(2),
              contactName: z.string().min(2),
              email: z.string().email(),
              phone: z.string().optional(),
              acceptTerms: z.boolean().refine(v => v === true),
              acceptFee: z.boolean().refine(v => v === true)
            });
            
            const validated = schema.parse(req.body);
            
            // Generate API key
            const apiKey = generateSecureApiKey();
            
            // Persist provider
            const [provider] = await storage.createProvider({
              ...validated,
              apiKey,
              acceptedTermsAt: new Date()
            });
            
            // Send confirmation email (async)
            sendProviderConfirmationEmail(provider);
            
            // Emit telemetry
            await emitBusinessEvent({
              eventName: 'provider_registered',
              actorType: 'provider',
              actorId: provider.id,
              properties: { organizationName: provider.organizationName }
            });
            
            res.status(201).json({
              success: true,
              providerId: provider.id,
              message: 'Registration received. We will review and send API credentials within 24 hours.'
            });
          });
    
    verification:
      - step: "curl -X POST https://provider-register-jamarrlmayes.replit.app/api/providers/register -H 'Content-Type: application/json' -d '{...}'"
        expect: "201 Created, providerId returned"
      
      - step: "Database query: SELECT * FROM providers WHERE email = 'test@example.com'"
        expect: "Provider record exists with feeRate = 0.03"
      
      - step: "Business events check"
        expect: "provider_registered event emitted"
    
    success_criteria:
      - POST endpoint validates input using Zod schema
      - Provider persisted to database with 3% fee rate (0.03)
      - API key generated securely
      - Confirmation email sent
      - Telemetry event emitted
      - Returns 201 Created with provider ID
    
    risk: medium
    notes: |
      - Requires database migration (npm run db:push)
      - Email delivery depends on email service configuration
      - API key security critical (use crypto.randomBytes)

  - id: FP-SEC-HEADERS-6OF6
    title: Audit and complete security headers (6/6)
    summary: Ensure all six required security headers present
    priority: P1
    estimate_hours: 1
    owner: Backend Engineering
    
    verification:
      - step: "curl -I https://provider-register-jamarrlmayes.replit.app/register | grep -i security-headers"
        expect: |
          ✅ Strict-Transport-Security
          ✅ Content-Security-Policy
          ✅ X-Content-Type-Options
          ✅ X-Frame-Options
          ✅ Referrer-Policy
          ✅ Permissions-Policy
    
    success_criteria:
      - All 6 headers present on /register and other HTML routes
      - Headers comply with security best practices
    
    risk: low

quick_wins:
  - description: Create /register page with 3% fee disclosure
    eta_minutes: 120-180
    impact: Unblocks T+48h Revenue Gate (2/5 → 4/5)
  
  - description: Add SEO meta tags to /register
    eta_minutes: 15
    impact: Improves B2B discoverability

dependencies:
  - app: scholar_auth
    reason: API credential generation requires JWT/JWKS infrastructure
    blocking: true
    notes: |
      - /register page can be public (no auth required for viewing form)
      - POST /register can work without auth initially
      - API key generation best practice: tie to scholar_auth for token-based API access

  - app: scholarship_api
    reason: Providers submit scholarships via scholarship_api
    blocking: false
    notes: Integration point for provider scholarship submissions

phased_rollout:
  phase_1:
    name: Registration Form (P0)
    tasks: [FP-PROVIDER-REGISTER]
    eta_hours: 2-4
    gate_unblocked: T+48h Revenue Gate (reaches 4/5)
  
  phase_2:
    name: Backend Integration (P1)
    tasks: [FP-PROVIDER-BACKEND]
    eta_hours: 3-4
    dependencies: [Database migration, email service]
    onboarding_enabled: true
  
  phase_3:
    name: Security & Polish (P1)
    tasks: [FP-SEC-HEADERS-6OF6]
    eta_hours: 1

total_eta_to_ready: 3-5 hours (Phase 1)
total_eta_to_4of5: 3-5 hours
total_eta_to_start_generating_revenue: 48-72 hours (includes provider setup time + first scholarship award)

revenue_projection:
  eta_to_first_provider_onboarded: 6-10 hours from implementation start
  eta_to_first_scholarship_submitted: 24-48 hours (provider setup lag)
  eta_to_first_3pct_fee_accrued: 48-72 hours (first scholarship award)
  assuming: |
    - scholar_auth JWKS fixed in 4-6 hours (parallel)
    - provider_register /register ready in 4 hours
    - Integration testing: 1 hour
    - Manual provider approval: 2-4 hours
    - Provider scholarship setup: 24 hours
    - First scholarship awarded: 48 hours
